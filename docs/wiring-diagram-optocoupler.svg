<svg viewBox="0 0 1120 820" width="1120" height="820" xmlns="http://www.w3.org/2000/svg" font-family="Inter, system-ui, -apple-system, sans-serif">
  <defs>
    <filter id="shadow" x="-4%" y="-4%" width="108%" height="112%">
      <feDropShadow dx="0" dy="3" stdDeviation="5" flood-color="#000" flood-opacity="0.25"/>
    </filter>
    <marker id="arr-grn" markerWidth="7" markerHeight="5" refX="6" refY="2.5" orient="auto">
      <path d="M0,0.3 L6,2.5 L0,4.7" fill="none" stroke="#22c55e" stroke-width="1"/>
    </marker>
    <marker id="arr-blu-l" markerWidth="7" markerHeight="5" refX="0" refY="2.5" orient="auto">
      <path d="M7,0.3 L1,2.5 L7,4.7" fill="none" stroke="#3b82f6" stroke-width="1"/>
    </marker>
    <marker id="arr-amb-l" markerWidth="7" markerHeight="5" refX="0" refY="2.5" orient="auto">
      <path d="M7,0.3 L1,2.5 L7,4.7" fill="none" stroke="#f59e0b" stroke-width="1"/>
    </marker>
    <marker id="arr-org-l" markerWidth="7" markerHeight="5" refX="0" refY="2.5" orient="auto">
      <path d="M7,0.3 L1,2.5 L7,4.7" fill="none" stroke="#f97316" stroke-width="1"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1120" height="820" rx="12" fill="#0f172a"/>
  <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
    <path d="M20,0 L0,0 0,20" fill="none" stroke="#1e293b" stroke-width="0.4"/>
  </pattern>
  <rect width="1120" height="820" fill="url(#grid)" opacity="0.5" rx="12"/>

  <!-- Title -->
  <text x="560" y="32" text-anchor="middle" font-size="17" font-weight="800" fill="#f1f5f9" letter-spacing="-0.3">Azkoyen Hopper U-II ↔ Wemos D1 Mini — Optocoupler Wiring</text>
  <text x="560" y="50" text-anchor="middle" font-size="11" fill="#64748b">4× PC817 Optocoupler Modules (bestep) · Galvanic Isolation · Normal Logic</text>

  <!-- CRITICAL WARNING BANNER -->
  <rect x="280" y="510" width="240" height="160" rx="8" fill="#7f1d1d" stroke="#991b1b" stroke-width="2"/>
  <text x="400" y="530" text-anchor="middle" font-size="11" font-weight="700" fill="#fecaca">⚠️ HOPPER DIP SWITCH: NEGATIVE MODE</text>
  <text x="400" y="550" text-anchor="middle" font-size="8" fill="#fecaca">CRITICAL: Hopper MUST be in NEGATIVE mode</text>
  <text x="290" y="568" font-size="8" fill="#fecaca">• Control: Active LOW (&lt; 0.5V = ON, &gt; 4V = OFF)</text>
  <text x="290" y="582" font-size="8" fill="#fecaca">• DIP switch: STANDARD + NEGATIVE</text>
  <text x="290" y="596" font-size="8" fill="#fecaca">• Location: Connector #6 on hopper board</text>
  <text x="290" y="616" font-size="7.5" font-weight="700" fill="#fca5a5">WRONG MODE SYMPTOMS:</text>
  <text x="290" y="630" font-size="7.5" fill="#fecaca">• Motor doesn't engage during dispense</text>
  <text x="290" y="642" font-size="7.5" fill="#fecaca">• Motor runs AFTER timeout (inverted)</text>
  <text x="290" y="660" font-size="7" fill="#94a3b8">Reference: docs/azkoyen-hopper-protocol.md §2.1</text>


  <!-- ╔══════════════════════════════════════════╗ -->
  <!-- ║           ESP8266 BOX (left)              ║ -->
  <!-- ╚══════════════════════════════════════════╝ -->
  <g filter="url(#shadow)">
    <rect x="40" y="100" width="200" height="380" rx="10" fill="#1e293b" stroke="#334155" stroke-width="1.5"/>
    <rect x="40" y="100" width="200" height="36" rx="10" fill="#1e3a5f"/>
    <rect x="40" y="126" width="200" height="10" fill="#1e3a5f"/>
    <text x="140" y="122" text-anchor="middle" font-size="13" font-weight="700" fill="#38bdf8">Wemos D1 Mini</text>
    <text x="140" y="134" text-anchor="middle" font-size="9" fill="#7dd3fc">ESP8266 · 3.3V Logic</text>
    <rect x="115" y="94" width="50" height="10" rx="3" fill="#334155" stroke="#475569" stroke-width="0.8"/>
    <text x="140" y="102" text-anchor="middle" font-size="6.5" fill="#64748b" font-family="monospace">USB</text>
  </g>

  <!-- ESP right-side pins -->
  <circle cx="240" cy="185" r="5" fill="#22c55e"/>
  <text x="226" y="181" text-anchor="end" font-size="11" font-weight="600" fill="#22c55e" font-family="monospace">D1</text>
  <text x="226" y="193" text-anchor="end" font-size="8" fill="#94a3b8">GPIO5 · OUT</text>

  <circle cx="240" cy="265" r="5" fill="#3b82f6"/>
  <text x="226" y="261" text-anchor="end" font-size="11" font-weight="600" fill="#3b82f6" font-family="monospace">D7</text>
  <text x="226" y="273" text-anchor="end" font-size="8" fill="#94a3b8">GPIO13 · IN</text>

  <circle cx="240" cy="345" r="5" fill="#f59e0b"/>
  <text x="226" y="341" text-anchor="end" font-size="11" font-weight="600" fill="#f59e0b" font-family="monospace">D5</text>
  <text x="226" y="353" text-anchor="end" font-size="8" fill="#94a3b8">GPIO14 · IN</text>

  <circle cx="240" cy="425" r="5" fill="#f97316"/>
  <text x="226" y="421" text-anchor="end" font-size="11" font-weight="600" fill="#f97316" font-family="monospace">D6</text>
  <text x="226" y="433" text-anchor="end" font-size="8" fill="#94a3b8">GPIO12 · IN</text>

  <!-- ESP left-side pins -->
  <circle cx="40" cy="185" r="5" fill="#a78bfa"/>
  <text x="54" y="181" font-size="10" font-weight="600" fill="#a78bfa" font-family="monospace">3.3V</text>
  <text x="54" y="193" font-size="8" fill="#94a3b8">Opto VCC</text>
  <circle cx="40" cy="265" r="5" fill="#64748b"/>
  <text x="54" y="261" font-size="10" font-weight="600" fill="#94a3b8" font-family="monospace">GND</text>


  <!-- ╔══════════════════════════════════════════╗ -->
  <!-- ║      AZKOYEN 2×5 CONNECTOR (right)        ║ -->
  <!-- ╚══════════════════════════════════════════╝ -->
  <g filter="url(#shadow)">
    <rect x="850" y="100" width="240" height="310" rx="10" fill="#1e293b" stroke="#334155" stroke-width="1.5"/>
    <rect x="850" y="100" width="240" height="36" rx="10" fill="#4a1d1d"/>
    <rect x="850" y="126" width="240" height="10" fill="#4a1d1d"/>
    <text x="970" y="122" text-anchor="middle" font-size="12" font-weight="700" fill="#fca5a5">Azkoyen Hopper U-II</text>
    <text x="970" y="134" text-anchor="middle" font-size="9" fill="#fecaca">12-24V ⎓ 450mA</text>
  </g>

  <!-- Connector housing outline -->
  <rect x="872" y="160" width="196" height="100" rx="6" fill="#0f172a" stroke="#475569" stroke-width="1.5"/>
  <text x="970" y="178" text-anchor="middle" font-size="9" font-weight="600" fill="#475569">2×5 IDC Connector</text>

  <!-- Top row pins (y=208): VCC, GND, H Level, Control (pin 7), Coin (pin 9) -->
  <circle cx="892" cy="208" r="6" fill="#ef4444" stroke="#fca5a5" stroke-width="1"/>
  <text x="892" y="198" text-anchor="middle" font-size="7" font-weight="600" fill="#fca5a5">VCC</text>
  <circle cx="930" cy="208" r="6" fill="#64748b" stroke="#94a3b8" stroke-width="1"/>
  <text x="930" y="198" text-anchor="middle" font-size="7" font-weight="600" fill="#94a3b8">GND</text>
  <circle cx="968" cy="208" r="6" fill="#334155" stroke="#475569" stroke-width="1"/>
  <text x="968" y="198" text-anchor="middle" font-size="7" fill="#475569">H Lvl</text>
  <circle cx="1006" cy="208" r="6" fill="#22c55e" stroke="#4ade80" stroke-width="1"/>
  <text x="1006" y="198" text-anchor="middle" font-size="7" font-weight="600" fill="#4ade80">Ctrl</text>
  <circle cx="1044" cy="208" r="6" fill="#3b82f6" stroke="#60a5fa" stroke-width="1"/>
  <text x="1044" y="198" text-anchor="middle" font-size="7" font-weight="600" fill="#60a5fa">Coin</text>

  <!-- Bottom row pins (y=240): VCC, VCC, GND, Error (pin 8), Empty (pin 10) -->
  <circle cx="892" cy="240" r="6" fill="#ef4444" stroke="#fca5a5" stroke-width="1"/>
  <text x="892" y="230" text-anchor="middle" font-size="7" font-weight="600" fill="#fca5a5">VCC</text>
  <circle cx="930" cy="240" r="6" fill="#ef4444" stroke="#fca5a5" stroke-width="1"/>
  <text x="930" y="230" text-anchor="middle" font-size="7" font-weight="600" fill="#fca5a5">VCC</text>
  <circle cx="968" cy="240" r="6" fill="#64748b" stroke="#94a3b8" stroke-width="1"/>
  <text x="968" y="230" text-anchor="middle" font-size="7" font-weight="600" fill="#94a3b8">GND</text>
  <circle cx="1006" cy="240" r="6" fill="#f59e0b" stroke="#fbbf24" stroke-width="1"/>
  <text x="1006" y="230" text-anchor="middle" font-size="7" font-weight="600" fill="#fbbf24">Error</text>
  <circle cx="1044" cy="240" r="6" fill="#f97316" stroke="#fb923c" stroke-width="1"/>
  <text x="1044" y="230" text-anchor="middle" font-size="7" font-weight="600" fill="#fb923c">Empty</text>

  <!-- Row labels -->
  <text x="878" y="212" text-anchor="end" font-size="8" fill="#64748b">A</text>
  <text x="878" y="244" text-anchor="end" font-size="8" fill="#64748b">B</text>

  <!-- N/C note for H Level -->
  <text x="968" y="265" text-anchor="middle" font-size="7.5" fill="#475569" font-style="italic">N/C</text>


  <!-- ╔══════════════════════════════════════════╗ -->
  <!-- ║  OPTOCOUPLER MODULE TEMPLATE              ║ -->
  <!-- ╚══════════════════════════════════════════╝ -->

  <!-- CH1: CONTROL Optocoupler (ESP→Hopper) -->
  <rect x="420" y="130" width="200" height="16" rx="3" fill="#14532d" opacity="0.6"/>
  <text x="520" y="141" text-anchor="middle" font-size="9" font-weight="700" fill="#4ade80">CH1 · MOTOR CONTROL — Optocoupler #1 · D1 → Pin 7 ✓ (R1 mod required!)</text>

  <!-- R1 MODIFICATION WARNING -->
  <rect x="650" y="145" width="180" height="95" rx="6" fill="#78350f" stroke="#f97316" stroke-width="2"/>
  <text x="740" y="163" text-anchor="middle" font-size="9" font-weight="700" fill="#fb923c">⚠️ CRITICAL: R1 MODIFICATION</text>
  <text x="660" y="180" font-size="7.5" fill="#fbbf24">Stock R1 = 1kΩ (only 3.3mA - TOO LOW!)</text>
  <text x="660" y="193" font-size="7.5" font-weight="700" fill="#fb923c">REQUIRED: Add 330Ω resistor in PARALLEL</text>
  <text x="660" y="206" font-size="7.5" fill="#fbbf24">Result: 248Ω → 13.3mA drive current ✓</text>
  <text x="660" y="222" font-size="7" fill="#fca5a5">Without modification:</text>
  <text x="660" y="233" font-size="7" fill="#fca5a5">• OUT stays 3-7V (not &lt; 0.5V)</text>
  <text x="740" y="245" text-anchor="middle" font-size="7" fill="#fca5a5">• Motor control unreliable/broken</text>

  <!-- Opto Module 1 -->
  <g filter="url(#shadow)">
    <rect x="470" y="155" width="140" height="70" rx="6" fill="#1e293b" stroke="#22c55e" stroke-width="1.5"/>
    <text x="540" y="172" text-anchor="middle" font-size="9" font-weight="700" fill="#22c55e">PC817 #1</text>
    <text x="540" y="184" text-anchor="middle" font-size="7" fill="#64748b">CONTROL</text>
    <!-- LED side (left) -->
    <circle cx="490" cy="200" r="4" fill="#a78bfa"/>
    <text x="490" y="216" text-anchor="middle" font-size="6" fill="#94a3b8">IN+</text>
    <circle cx="510" cy="200" r="4" fill="#22c55e"/>
    <text x="510" y="216" text-anchor="middle" font-size="6" fill="#94a3b8">IN-</text>
    <!-- Output side (right) -->
    <circle cx="550" cy="200" r="4" fill="#ef4444"/>
    <text x="550" y="216" text-anchor="middle" font-size="6" fill="#94a3b8">VCC</text>
    <circle cx="570" cy="200" r="4" fill="#22c55e"/>
    <text x="570" y="216" text-anchor="middle" font-size="6" fill="#94a3b8">OUT</text>
    <circle cx="590" cy="200" r="4" fill="#64748b"/>
    <text x="590" y="216" text-anchor="middle" font-size="6" fill="#94a3b8">GND</text>
  </g>

  <!-- Wiring for Control -->
  <!-- ESP 3.3V → IN+ -->
  <line x1="35" y1="185" x2="20" y2="185" stroke="#a78bfa" stroke-width="2"/>
  <line x1="20" y1="185" x2="20" y2="70" stroke="#a78bfa" stroke-width="2"/>
  <line x1="20" y1="70" x2="490" y2="70" stroke="#a78bfa" stroke-width="2"/>
  <line x1="490" y1="70" x2="490" y2="196" stroke="#a78bfa" stroke-width="2"/>
  <!-- ESP D1 → IN- -->
  <line x1="245" y1="185" x2="280" y2="185" stroke="#22c55e" stroke-width="2"/>
  <line x1="280" y1="185" x2="280" y2="90" stroke="#22c55e" stroke-width="2"/>
  <line x1="280" y1="90" x2="510" y2="90" stroke="#22c55e" stroke-width="2"/>
  <line x1="510" y1="90" x2="510" y2="196" stroke="#22c55e" stroke-width="2"/>
  <!-- VCC → 12V (provides pull-up voltage) -->
  <text x="550" y="188" text-anchor="middle" font-size="8" font-weight="700" fill="#4ade80">✓ 12V</text>
  <text x="550" y="232" text-anchor="middle" font-size="6" fill="#4ade80">Connect to 12V VCC</text>
  <text x="550" y="240" text-anchor="middle" font-size="5" fill="#94a3b8">Provides pull-up voltage</text>
  <!-- OUT → Hopper Control (pin 7, now at top row) -->
  <line x1="574" y1="200" x2="740" y2="200" stroke="#22c55e" stroke-width="2"/>
  <line x1="740" y1="200" x2="740" y2="208" stroke="#22c55e" stroke-width="2"/>
  <line x1="740" y1="208" x2="1000" y2="208" stroke="#22c55e" stroke-width="2" marker-end="url(#arr-grn)"/>
  <!-- GND → 12V GND -->
  <line x1="590" y1="204" x2="590" y2="230" stroke="#64748b" stroke-width="1.5"/>
  <text x="595" y="235" font-size="7" fill="#64748b">12V GND</text>


  <!-- CH2: COIN Optocoupler (Hopper→ESP) -->
  <rect x="420" y="270" width="200" height="16" rx="3" fill="#1e3a5f" opacity="0.6"/>
  <text x="520" y="281" text-anchor="middle" font-size="9" font-weight="700" fill="#60a5fa">CH2 · COIN INPUT — Optocoupler #2 · Pin 9 → D7 ✓</text>

  <!-- Opto Module 2 (FLIPPED: output on left, input on right) -->
  <g filter="url(#shadow)">
    <rect x="470" y="295" width="140" height="70" rx="6" fill="#1e293b" stroke="#3b82f6" stroke-width="1.5"/>
    <text x="540" y="312" text-anchor="middle" font-size="9" font-weight="700" fill="#3b82f6">PC817 #2</text>
    <text x="540" y="324" text-anchor="middle" font-size="7" fill="#64748b">COIN</text>
    <!-- Output side (left) - ESP -->
    <circle cx="490" cy="340" r="4" fill="#a78bfa"/>
    <text x="490" y="356" text-anchor="middle" font-size="6" fill="#94a3b8">VCC</text>
    <circle cx="510" cy="340" r="4" fill="#3b82f6"/>
    <text x="510" y="356" text-anchor="middle" font-size="6" fill="#94a3b8">OUT</text>
    <circle cx="530" cy="340" r="4" fill="#64748b"/>
    <text x="530" y="356" text-anchor="middle" font-size="6" fill="#94a3b8">GND</text>
    <!-- LED side (right) - Hopper -->
    <circle cx="570" cy="340" r="4" fill="#3b82f6"/>
    <text x="570" y="356" text-anchor="middle" font-size="6" fill="#94a3b8">IN+</text>
    <circle cx="590" cy="340" r="4" fill="#64748b"/>
    <text x="590" y="356" text-anchor="middle" font-size="6" fill="#94a3b8">IN-</text>
  </g>

  <!-- Wiring for Coin -->
  <!-- Hopper Coin (pin 9, top row) → IN+ -->
  <line x1="1044" y1="214" x2="1044" y2="330" stroke="#3b82f6" stroke-width="2"/>
  <line x1="1044" y1="330" x2="650" y2="330" stroke="#3b82f6" stroke-width="2"/>
  <line x1="650" y1="330" x2="650" y2="340" stroke="#3b82f6" stroke-width="2"/>
  <line x1="650" y1="340" x2="574" y2="340" stroke="#3b82f6" stroke-width="2"/>
  <!-- Hopper GND → IN- -->
  <line x1="590" y1="344" x2="590" y2="370" stroke="#64748b" stroke-width="1.5"/>
  <text x="595" y="375" font-size="7" fill="#64748b">12V GND</text>
  <!-- VCC → 3.3V -->
  <line x1="490" y1="336" x2="490" y2="295" stroke="#a78bfa" stroke-width="1.5"/>
  <text x="495" y="292" font-size="7" fill="#c4b5fd">3.3V</text>
  <!-- OUT → ESP D7 -->
  <line x1="506" y1="340" x2="350" y2="340" stroke="#3b82f6" stroke-width="2"/>
  <line x1="350" y1="340" x2="350" y2="265" stroke="#3b82f6" stroke-width="2"/>
  <line x1="350" y1="265" x2="249" y2="265" stroke="#3b82f6" stroke-width="2" marker-end="url(#arr-blu-l)"/>
  <!-- GND → ESP GND -->
  <line x1="530" y1="344" x2="530" y2="370" stroke="#64748b" stroke-width="1.5"/>
  <text x="535" y="375" font-size="7" fill="#64748b">ESP GND</text>


  <!-- CH3: ERROR Optocoupler (Hopper→ESP) -->
  <rect x="420" y="410" width="200" height="16" rx="3" fill="#422006" opacity="0.6"/>
  <text x="520" y="421" text-anchor="middle" font-size="9" font-weight="700" fill="#fbbf24">CH3 · ERROR INPUT — Optocoupler #3 · Pin 8 → D5 ✓</text>

  <!-- Opto Module 3 (FLIPPED: output on left, input on right) -->
  <g filter="url(#shadow)">
    <rect x="470" y="435" width="140" height="70" rx="6" fill="#1e293b" stroke="#f59e0b" stroke-width="1.5"/>
    <text x="540" y="452" text-anchor="middle" font-size="9" font-weight="700" fill="#f59e0b">PC817 #3</text>
    <text x="540" y="464" text-anchor="middle" font-size="7" fill="#64748b">ERROR</text>
    <!-- Output side (left) - ESP -->
    <circle cx="490" cy="480" r="4" fill="#a78bfa"/>
    <text x="490" y="496" text-anchor="middle" font-size="6" fill="#94a3b8">VCC</text>
    <circle cx="510" cy="480" r="4" fill="#f59e0b"/>
    <text x="510" y="496" text-anchor="middle" font-size="6" fill="#94a3b8">OUT</text>
    <circle cx="530" cy="480" r="4" fill="#64748b"/>
    <text x="530" y="496" text-anchor="middle" font-size="6" fill="#94a3b8">GND</text>
    <!-- LED side (right) - Hopper -->
    <circle cx="570" cy="480" r="4" fill="#f59e0b"/>
    <text x="570" y="496" text-anchor="middle" font-size="6" fill="#94a3b8">IN+</text>
    <circle cx="590" cy="480" r="4" fill="#64748b"/>
    <text x="590" y="496" text-anchor="middle" font-size="6" fill="#94a3b8">IN-</text>
  </g>

  <!-- Wiring for Error -->
  <!-- Hopper Error (pin 8, bottom row) → IN+ -->
  <line x1="1006" y1="246" x2="1006" y2="470" stroke="#f59e0b" stroke-width="2"/>
  <line x1="1006" y1="470" x2="680" y2="470" stroke="#f59e0b" stroke-width="2"/>
  <line x1="680" y1="470" x2="680" y2="480" stroke="#f59e0b" stroke-width="2"/>
  <line x1="680" y1="480" x2="574" y2="480" stroke="#f59e0b" stroke-width="2"/>
  <!-- Hopper GND → IN- -->
  <line x1="590" y1="484" x2="590" y2="510" stroke="#64748b" stroke-width="1.5"/>
  <text x="595" y="515" font-size="7" fill="#64748b">12V GND</text>
  <!-- VCC → 3.3V -->
  <line x1="490" y1="476" x2="490" y2="435" stroke="#a78bfa" stroke-width="1.5"/>
  <text x="495" y="432" font-size="7" fill="#c4b5fd">3.3V</text>
  <!-- OUT → ESP D5 -->
  <line x1="506" y1="480" x2="330" y2="480" stroke="#f59e0b" stroke-width="2"/>
  <line x1="330" y1="480" x2="330" y2="345" stroke="#f59e0b" stroke-width="2"/>
  <line x1="330" y1="345" x2="249" y2="345" stroke="#f59e0b" stroke-width="2" marker-end="url(#arr-amb-l)"/>
  <!-- GND → ESP GND -->
  <line x1="530" y1="484" x2="530" y2="510" stroke="#64748b" stroke-width="1.5"/>
  <text x="535" y="515" font-size="7" fill="#64748b">ESP GND</text>


  <!-- CH4: EMPTY Optocoupler (Hopper→ESP) -->
  <rect x="420" y="550" width="200" height="16" rx="3" fill="#431407" opacity="0.6"/>
  <text x="520" y="561" text-anchor="middle" font-size="9" font-weight="700" fill="#fb923c">CH4 · EMPTY INPUT — Optocoupler #4 · Pin 10 → D6 ✓</text>

  <!-- Opto Module 4 (FLIPPED: output on left, input on right) -->
  <g filter="url(#shadow)">
    <rect x="470" y="575" width="140" height="70" rx="6" fill="#1e293b" stroke="#f97316" stroke-width="1.5"/>
    <text x="540" y="592" text-anchor="middle" font-size="9" font-weight="700" fill="#f97316">PC817 #4</text>
    <text x="540" y="604" text-anchor="middle" font-size="7" fill="#64748b">EMPTY</text>
    <!-- Output side (left) - ESP -->
    <circle cx="490" cy="620" r="4" fill="#a78bfa"/>
    <text x="490" y="636" text-anchor="middle" font-size="6" fill="#94a3b8">VCC</text>
    <circle cx="510" cy="620" r="4" fill="#f97316"/>
    <text x="510" y="636" text-anchor="middle" font-size="6" fill="#94a3b8">OUT</text>
    <circle cx="530" cy="620" r="4" fill="#64748b"/>
    <text x="530" y="636" text-anchor="middle" font-size="6" fill="#94a3b8">GND</text>
    <!-- LED side (right) - Hopper -->
    <circle cx="570" cy="620" r="4" fill="#f97316"/>
    <text x="570" y="636" text-anchor="middle" font-size="6" fill="#94a3b8">IN+</text>
    <circle cx="590" cy="620" r="4" fill="#64748b"/>
    <text x="590" y="636" text-anchor="middle" font-size="6" fill="#94a3b8">IN-</text>
  </g>

  <!-- Wiring for Empty -->
  <!-- Hopper Empty (pin 10, bottom row) → IN+ -->
  <line x1="1044" y1="246" x2="1068" y2="246" stroke="#f97316" stroke-width="2"/>
  <line x1="1068" y1="246" x2="1068" y2="610" stroke="#f97316" stroke-width="2"/>
  <line x1="1068" y1="610" x2="710" y2="610" stroke="#f97316" stroke-width="2"/>
  <line x1="710" y1="610" x2="710" y2="620" stroke="#f97316" stroke-width="2"/>
  <line x1="710" y1="620" x2="574" y2="620" stroke="#f97316" stroke-width="2"/>
  <!-- Hopper GND → IN- -->
  <line x1="590" y1="624" x2="590" y2="650" stroke="#64748b" stroke-width="1.5"/>
  <text x="595" y="655" font-size="7" fill="#64748b">12V GND</text>
  <!-- VCC → 3.3V -->
  <line x1="490" y1="616" x2="490" y2="575" stroke="#a78bfa" stroke-width="1.5"/>
  <text x="495" y="572" font-size="7" fill="#c4b5fd">3.3V</text>
  <!-- OUT → ESP D6 -->
  <line x1="506" y1="620" x2="310" y2="620" stroke="#f97316" stroke-width="2"/>
  <line x1="310" y1="620" x2="310" y2="425" stroke="#f97316" stroke-width="2"/>
  <line x1="310" y1="425" x2="249" y2="425" stroke="#f97316" stroke-width="2" marker-end="url(#arr-org-l)"/>
  <!-- GND → ESP GND -->
  <line x1="530" y1="624" x2="530" y2="650" stroke="#64748b" stroke-width="1.5"/>
  <text x="535" y="655" font-size="7" fill="#64748b">ESP GND</text>


  <!-- ╔══════════════════════════════════════════╗ -->
  <!-- ║  BOM + LOGIC NOTES                        ║ -->
  <!-- ╚══════════════════════════════════════════╝ -->

  <!-- BOM box -->
  <rect x="40" y="510" width="200" height="120" rx="8" fill="#1e293b" stroke="#334155" stroke-width="1" opacity="0.85"/>
  <text x="56" y="530" font-size="10" font-weight="700" fill="#94a3b8">Bill of Materials</text>
  <text x="56" y="548" font-size="9" fill="#94a3b8">4× PC817 Optocoupler Module</text>
  <text x="56" y="562" font-size="9" fill="#94a3b8">   (bestep, with R1+R2 onboard)</text>
  <text x="56" y="580" font-size="9" fill="#94a3b8">1× 2200µF 25V capacitor</text>
  <text x="56" y="598" font-size="9" font-weight="700" fill="#f97316">1× 330Ω resistor (1/4W)</text>
  <text x="56" y="616" font-size="9" fill="#fb923c">   For R1 mod on Opto #1 ⚠️</text>

  <!-- Logic notes box -->
  <rect x="40" y="640" width="200" height="145" rx="8" fill="#1e293b" stroke="#334155" stroke-width="1" opacity="0.85"/>
  <text x="56" y="660" font-size="10" font-weight="700" fill="#4ade80">✓ Normal Logic (NEGATIVE mode)</text>
  <text x="56" y="680" font-size="9" fill="#94a3b8">Control: GPIO HIGH = Motor ON</text>
  <text x="56" y="696" font-size="9" fill="#94a3b8">Coin:    GPIO LOW = Coin pulse</text>
  <text x="56" y="712" font-size="9" fill="#94a3b8">Error:   GPIO LOW = Error active</text>
  <text x="56" y="728" font-size="9" fill="#94a3b8">Empty:   GPIO LOW = Hopper empty</text>
  <line x1="50" y1="738" x2="230" y2="738" stroke="#334155" stroke-width="0.5"/>
  <text x="56" y="752" font-size="8" font-weight="700" fill="#fbbf24">Voltage Levels (R1 modified):</text>
  <text x="56" y="764" font-size="8" fill="#94a3b8">Motor ON:  OUT &lt; 0.5V</text>
  <text x="56" y="776" font-size="8" fill="#94a3b8">Motor OFF: OUT ~6V (&gt; 4V OK)</text>

  <!-- Connector map box -->
  <rect x="850" y="318" width="240" height="100" rx="8" fill="#1e293b" stroke="#334155" stroke-width="1" opacity="0.85"/>
  <text x="866" y="338" font-size="10" font-weight="700" fill="#94a3b8">2×5 IDC Pin Map (Alt. numbering)</text>
  <text x="866" y="356" font-size="8.5" fill="#94a3b8" font-family="monospace">A: VCC  GND  H.Lvl  Ctrl   Coin</text>
  <text x="866" y="372" font-size="8.5" fill="#94a3b8" font-family="monospace">B: VCC  VCC  GND    Error  Empty</text>
  <line x1="866" y1="380" x2="1070" y2="380" stroke="#334155" stroke-width="0.5"/>
  <text x="866" y="396" font-size="8" fill="#64748b">Pins 7-10: Ctrl(7) Error(8) Coin(9) Empty(10)</text>
  <text x="866" y="410" font-size="8" fill="#64748b">H Level pin not connected (N/C)</text>


  <!-- ╔══════════════════════════════════════════╗ -->
  <!-- ║  COMMON GND BUS                           ║ -->
  <!-- ╚══════════════════════════════════════════╝ -->

  <!-- GND bus bar -->
  <line x1="20" y1="760" x2="1068" y2="760" stroke="#64748b" stroke-width="3" opacity="0.5"/>
  <circle cx="20" cy="760" r="3.5" fill="#64748b" opacity="0.8"/>
  <circle cx="1068" cy="760" r="3.5" fill="#64748b" opacity="0.8"/>
  <text x="20" y="752" text-anchor="middle" font-size="7.5" fill="#64748b">ESP</text>
  <text x="1068" y="752" text-anchor="middle" font-size="7.5" fill="#64748b">Hopper</text>

  <rect x="500" y="766" width="106" height="16" rx="4" fill="#1e293b" stroke="#334155" stroke-width="0.8"/>
  <text x="553" y="778" text-anchor="middle" font-size="9" font-weight="600" fill="#94a3b8">COMMON GND</text>
  <!-- Earth symbol -->
  <line x1="553" y1="786" x2="553" y2="794" stroke="#64748b" stroke-width="1.5"/>
  <line x1="544" y1="794" x2="562" y2="794" stroke="#64748b" stroke-width="1.5"/>
  <line x1="547" y1="798" x2="559" y2="798" stroke="#64748b" stroke-width="1.2"/>

  <!-- ESP GND → bus -->
  <line x1="35" y1="265" x2="20" y2="265" stroke="#64748b" stroke-width="2" opacity="0.5"/>
  <line x1="20" y1="265" x2="20" y2="760" stroke="#64748b" stroke-width="2" opacity="0.5"/>

  <!-- Hopper GND → bus -->
  <line x1="930" y1="214" x2="930" y2="280" stroke="#64748b" stroke-width="2" opacity="0.5"/>
  <line x1="968" y1="246" x2="968" y2="280" stroke="#64748b" stroke-width="2" opacity="0.5"/>
  <line x1="930" y1="280" x2="1068" y2="280" stroke="#64748b" stroke-width="2" opacity="0.5"/>
  <line x1="1068" y1="280" x2="1068" y2="760" stroke="#64748b" stroke-width="2" opacity="0.5"/>
</svg>
